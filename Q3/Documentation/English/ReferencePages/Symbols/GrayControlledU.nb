(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     88747,       2653]
NotebookOptionsPosition[     79148,       2455]
NotebookOutlinePosition[     81394,       2511]
CellTagsIndexPosition[     81308,       2506]
WindowTitle->GrayControlledU
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[GridBox[{
   {GridBox[{
      {
       ItemBox[Cell[BoxData[
         RowBox[{
          TemplateBox[{12},
           "Spacer1"], Cell["Q3 SYMBOL", "PacletNameCell",
           TextAlignment->Center,ExpressionUUID->
           "84c7f7d7-153f-40ff-b1ac-e93aee4a6f56"], 
          TemplateBox[{8},
           "Spacer1"]}]],
         TextAlignment->Center,ExpressionUUID->
         "5d40a87e-7dfe-42f0-8c89-5204dc574aa2"],
        Background->RGBColor[0.490196, 0.576471, 0.690196],
        ItemSize->Full], ""}
     },
     GridBoxAlignment->{"Rows" -> {{Center}}},
     GridBoxItemSize->{"Columns" -> {Full, 
         Scaled[0.02]}, "Rows" -> {{2.5}}}], Cell[TextData[{
     Cell[BoxData[
      TagBox[
       ActionMenuBox[
        FrameBox[Cell[TextData[{
          "See Also",
          " ",
          Cell[BoxData[
           GraphicsBox[
            {GrayLevel[0.66667], Thickness[0.13], 
             LineBox[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]},
            AspectRatio->1,
            AxesStyle->Large,
            FrameStyle->Large,
            ImageSize->20,
            PlotRange->{{-3, 4}, {-1, 1}},
            PlotRangePadding->Scaled[0.025]]],ExpressionUUID->
           "a36f5caa-a9b5-4181-b07f-1815de640a78"]
         }],ExpressionUUID->"2ee03b2f-2757-4bd2-954d-213207974038"],
         StripOnInput->False], {"\<\"GrayControlledW\"\>":>
        Documentation`HelpLookup["paclet:Q3/ref/GrayControlledW"]},
        Appearance->None,
        MenuAppearance->Automatic,
        MenuStyle->"SeeAlso"],
       MouseAppearanceTag["LinkHand"]]],
      LineSpacing->{1.4, 0},ExpressionUUID->
      "5541f409-5517-49a7-9f8f-539877c4a61f"],
     "\[ThickSpace]\[ThickSpace]\[ThickSpace]\[ThickSpace]\[ThickSpace]\
\[ThickSpace]",
     Cell[BoxData[
      TagBox[
       ActionMenuBox[
        FrameBox[Cell[TextData[{
          "Related Guides",
          " ",
          Cell[BoxData[
           GraphicsBox[
            {GrayLevel[0.66667], Thickness[0.13], 
             LineBox[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]},
            AspectRatio->1,
            AxesStyle->Large,
            FrameStyle->Large,
            ImageSize->20,
            PlotRange->{{-3, 4}, {-1, 1}},
            PlotRangePadding->Scaled[0.025]]],ExpressionUUID->
           "3933bf10-9d11-46e1-b3e1-9b86e390ff55"]
         }],ExpressionUUID->"5695549f-8689-4c66-ac6d-e46dd70c6af1"],
         StripOnInput->False], {"\<\"Quisso Package Guide\"\>":>
        Documentation`HelpLookup[
        "paclet:Q3/guide/QuissoPackageGuide"], "\<\"Q3\"\>":>
        Documentation`HelpLookup["paclet:Q3/guide/Q3"]},
        Appearance->None,
        MenuAppearance->Automatic,
        MenuStyle->"MoreAbout"],
       MouseAppearanceTag["LinkHand"]]],
      LineSpacing->{1.4, 0},ExpressionUUID->
      "8e0545f7-d34c-4c10-add6-16f45b897787"],
     "\[ThickSpace]\[ThickSpace]\[ThickSpace]\[ThickSpace]\[ThickSpace]\
\[ThickSpace]",
     Cell[BoxData[
      TagBox[
       ActionMenuBox[
        FrameBox[Cell[TextData[{
          "Tutorials",
          " ",
          Cell[BoxData[
           GraphicsBox[
            {GrayLevel[0.66667], Thickness[0.13], 
             LineBox[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]},
            AspectRatio->1,
            AxesStyle->Large,
            FrameStyle->Large,
            ImageSize->20,
            PlotRange->{{-3, 4}, {-1, 1}},
            PlotRangePadding->Scaled[0.025]]],ExpressionUUID->
           "9664aa8c-7ef2-4542-834a-fe0f78773b70"]
         }],ExpressionUUID->"c4a097ac-31cb-4a39-accf-9ff36e6d525a"],
         StripOnInput->False], {"\<\"Quisso: Quick Start\"\>":>
        Documentation`HelpLookup[
        "paclet:Q3/tutorial/QuissoQuickStart"], "\<\"Q3: Quick Start\"\>":>
        Documentation`HelpLookup["paclet:Q3/tutorial/Q3QuickStart"]},
        Appearance->None,
        MenuAppearance->Automatic,
        MenuStyle->"Tutorials"],
       MouseAppearanceTag["LinkHand"]]],
      LineSpacing->{1.4, 0},ExpressionUUID->
      "bdabd0ba-fe2c-4224-8795-295095d9e50e"],
     "\[ThickSpace]\[ThickSpace]\[ThickSpace]\[ThickSpace]\[ThickSpace]\
\[ThickSpace]",
     Cell[BoxData[
      TagBox[
       ActionMenuBox[
        FrameBox[Cell[TextData[{
          "URL",
          " ",
          Cell[BoxData[
           GraphicsBox[
            {GrayLevel[0.66667], Thickness[0.13], 
             LineBox[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]},
            AspectRatio->1,
            AxesStyle->Large,
            FrameStyle->Large,
            ImageSize->20,
            PlotRange->{{-3, 4}, {-1, 1}},
            PlotRangePadding->Scaled[0.025]]],ExpressionUUID->
           "a337b1c3-f0d9-4e77-bdbe-385469618f18"]
         }],ExpressionUUID->"dfd42c6d-a51d-4155-bad4-7e80b53a09b9"],
         StripOnInput->False], {"\<\"Q3/ref/GrayControlledU\"\>":>
        None, "\<\"Copy Wolfram Documentation Center URL\"\>":>
        Module[{DocumentationSearch`Private`nb$}, 
         DocumentationSearch`Private`nb$ = NotebookPut[
            Notebook[{
              Cell["Q3/ref/GrayControlledU"]}, Visible -> False]]; 
         SelectionMove[DocumentationSearch`Private`nb$, All, Notebook]; 
         FrontEndTokenExecute[DocumentationSearch`Private`nb$, "Copy"]; 
         NotebookClose[DocumentationSearch`Private`nb$]; Null], 
        Delimiter, "\<\"Copy web URL\"\>":>
        Module[{DocumentationSearch`Private`nb$}, 
         DocumentationSearch`Private`nb$ = NotebookPut[
            Notebook[{
              Cell[
               BoxData[
                MakeBoxes[
                 Hyperlink[
                 "http://reference.wolfram.com/language/Q3/ref/\
GrayControlledU.html"], StandardForm]], "Input", TextClipboardType -> 
               "PlainText"]}, Visible -> False]]; 
         SelectionMove[DocumentationSearch`Private`nb$, All, Notebook]; 
         FrontEndTokenExecute[DocumentationSearch`Private`nb$, "Copy"]; 
         NotebookClose[DocumentationSearch`Private`nb$]; 
         Null], "\<\"Go to web URL\"\>":>FrontEndExecute[{
          NotebookLocate[{
            URL[If[
               TrueQ[DocumentationBuild`Make`Private`wsmlinkQ$85074], 
               "http://reference.wolfram.com/system-modeler/", 
               "http://reference.wolfram.com/language/"] <> 
             "Q3/ref/GrayControlledU" <> ".html"], None}]}]},
        Appearance->None,
        MenuAppearance->Automatic,
        MenuStyle->"URLMenu"],
       MouseAppearanceTag["LinkHand"]]],
      LineSpacing->{1.4, 0},ExpressionUUID->
      "83f8b9d6-8119-49cc-98a7-6c765352dd7a"]
    }], "AnchorBar",
     CacheGraphics->False,ExpressionUUID->
     "275065a2-415f-4efd-a951-1a423309e9d2"]}
  }]], "AnchorBarGrid",
 CellID->1,ExpressionUUID->"47048ba5-f0a2-4e20-af56-38a63a82a885"],

Cell["Q3`", "ContextNameCell",ExpressionUUID->"22b3d455-ffc2-46f7-b5fe-ea32a14c2896"],

Cell[CellGroupData[{

Cell[BoxData[GridBox[{
   {Cell[TextData[{
     Cell[
     "GrayControlledU", "ObjectName",ExpressionUUID->
      "3e10a775-5416-4f8a-a072-be91e92c7758"],
     Cell[BoxData[
      TemplateBox[{8},
       "Spacer1"]],ExpressionUUID->"58c74241-63e1-4ea7-bbd2-1f58ca340048"],
     Cell[BoxData[
     ""], "ObjectNameTranslation",ExpressionUUID->
      "20414c96-18c7-4251-875c-1d3818d203f1"]
    }],ExpressionUUID->"dd6d7e77-65d9-4603-a870-e73211a6cb64"], 
    "\[SpanFromLeft]"}
  }]], "ObjectNameGrid",ExpressionUUID->"6dd8a8fd-ae6b-498f-aab0-\
2e155d2a213c"],

Cell[BoxData[GridBox[{
   {"", Cell[TextData[{
     Cell[BoxData[
      RowBox[{"GrayControlledU", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          SubscriptBox[
           StyleBox["q", "TI"], 
           StyleBox["1", "TR"]], ",", 
          SubscriptBox[
           StyleBox["q", "TI"], 
           StyleBox["2", "TR"]], ",", "..."}], "}"}], ",", 
        StyleBox["u", "TI"]}], "]"}]], "InlineFormula",
      FontFamily->"Source Sans Pro",ExpressionUUID->
      "d040113a-159e-4a79-a969-e4b8dadd2663"],
     " \[LineSeparator]uses the Gray code to decompose the ",
     Cell[BoxData[
      StyleBox["n", "TI"]], "InlineFormula",
      FontFamily->"Source Sans Pro",ExpressionUUID->
      "eb3ca762-c98b-4b60-ae3b-0fdf9fd6a7e9"],
     "-bit controlled unitary gate into elementary gates. Here ",
     Cell[BoxData[
      RowBox[{
       SubscriptBox[
        StyleBox["q", "TI"], 
        StyleBox["1", "TR"]], ",", " ", 
       SubscriptBox[
        StyleBox["q", "TI"], 
        StyleBox["2", "TR"]], ",", " ", "..."}]], "InlineFormula",
      FontFamily->"Source Sans Pro",ExpressionUUID->
      "7d007209-7b59-4a3c-8255-628cfd3a1fad"],
     " are the control qubits and ",
     Cell[BoxData[
      StyleBox["u", "TI"]], "InlineFormula",
      FontFamily->"Source Sans Pro",ExpressionUUID->
      "710b20de-73d0-488f-9460-940defed325f"],
     " is the unitary operator on the target qubit."
    }],ExpressionUUID->"d1d48c1b-9441-46a1-9953-638bd719427e"]}
  }]], "Usage",
 GridBoxOptions->{
 GridBoxBackground->{"Columns" -> {{None}}, "Rows" -> {{None}}}},
 CellID->982511436,ExpressionUUID->"b3e4f65c-2d83-4354-8446-bf100f73dabc"]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  DynamicBox[ToBoxes[
    If[
     MatchQ[
      CurrentValue[
       EvaluationNotebook[], {
       TaggingRules, "Openers", "PrimaryExamplesSection"}, Open], 
      Alternatives[True, Open]], 
     Style[
      Graphics[{
        Thickness[0.18], 
        RGBColor[0.8509803921568627, 0.396078431372549, 0], 
        Line[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]}, AspectRatio -> 1, 
       PlotRange -> {{-3, 4}, {-1, 1}}, ImageSize -> 20], Magnification -> 
      0.68 Inherited], 
     Rotate[
      Style[
       Graphics[{
         Thickness[0.18], 
         RGBColor[0.8509803921568627, 0.396078431372549, 0], 
         Line[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]}, AspectRatio -> 1, 
        PlotRange -> {{-3, 4}, {-1, 1}}, ImageSize -> 20], Magnification -> 
       0.68 Inherited], Rational[1, 2] Pi, {-1.65, -1}]]],
   ImageSizeCache->{14., {5., 9.}}]],ExpressionUUID->
  "cc577c7b-4182-4d48-b9f0-910b5a2e3d1d"],
 Cell[BoxData[
  TemplateBox[{1},
   "Spacer1"]],ExpressionUUID->"7c9632ea-f988-47ca-a166-27062d346f43"],
 "Examples",
 "\[NonBreakingSpace]\[NonBreakingSpace]",
 Cell["(2)", "ExampleCount",ExpressionUUID->
  "1d40e198-a0d1-4d4c-9501-ecf9e18cd25f"]
}], "PrimaryExamplesSection",
 WholeCellGroupOpener->True,
 CacheGraphics->False,
 CellTags->"PrimaryExamplesSection",
 CellID->1343452301,ExpressionUUID->"cb14edfe-4e41-4b7f-bb40-ce1d2a636275"],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  DynamicBox[ToBoxes[
    If[
     MatchQ[
      CurrentValue[
       EvaluationNotebook[], {TaggingRules, "Openers", "ExampleSection", "0"},
        Closed], 
      Alternatives[Open, True]], 
     Style[
      Graphics[{
        Thickness[0.18], 
        RGBColor[0.8509803921568627, 0.396078431372549, 0], 
        Line[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]}, AspectRatio -> 1, 
       PlotRange -> {{-3, 4}, {-1, 1}}, ImageSize -> 20], Magnification -> 
      0.68 Inherited], 
     Rotate[
      Style[
       Graphics[{
         Thickness[0.18], 
         RGBColor[0.8509803921568627, 0.396078431372549, 0], 
         Line[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]}, AspectRatio -> 1, 
        PlotRange -> {{-3, 4}, {-1, 1}}, ImageSize -> 20], Magnification -> 
       0.68 Inherited], Rational[1, 2] Pi, {-1.65, -1}]]],
   ImageSizeCache->{14., {5., 9.}}]],ExpressionUUID->
  "75a91435-ce27-4b95-b5a5-4574b24a9444"],
 Cell[BoxData[
  TemplateBox[{1},
   "Spacer1"]],ExpressionUUID->"8cf8e428-483b-41a4-b5f1-f03c041d3060"],
 "Basic Examples",
 "\[NonBreakingSpace]\[NonBreakingSpace]",
 Cell["(1)", "ExampleCount",ExpressionUUID->
  "676fcee8-bad3-47cd-8914-4cb09fbd2945"]
}], "ExampleSection", "ExampleSection",
 WholeCellGroupOpener->True,
 CacheGraphics->False,
 CellID->759758349,ExpressionUUID->"34e404e1-5794-44af-ae85-eb441e923296"],

Cell[BoxData[
 RowBox[{"<<", "Q3`"}]], "Input",
 CellLabel->"In[1]:=",
 CellID->615462090,ExpressionUUID->"de7e4126-573b-4352-9228-57135f392984"],

Cell[BoxData[
 RowBox[{"Let", "[", 
  RowBox[{"Qubit", ",", "S"}], "]"}]], "Input",
 CellLabel->"In[2]:=",
 CellID->490833089,ExpressionUUID->"3a8b49f4-1d18-43e6-af32-b3cc90ed19d0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$L", "=", "2"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jj", "=", 
   RowBox[{"Range", "[", "$L", "]"}]}], ";"}]}], "Input",
 CellLabel->"In[3]:=",
 CellID->947038696,ExpressionUUID->"e7251fdf-3af5-4aee-aa05-19d24d1b4c03"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"cc", "=", 
  RowBox[{"S", "[", 
   RowBox[{"jj", ",", "None"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"T", "=", 
  RowBox[{"S", "[", 
   RowBox[{
    RowBox[{"$L", "+", "1"}], ",", "None"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"op", "=", 
  RowBox[{"Rotation", "[", 
   RowBox[{
    RowBox[{"Pi", "/", "3"}], ",", 
    RowBox[{"T", "[", "3", "]"}]}], "]"}]}]}], "Input",
 CellLabel->"In[4]:=",
 CellID->1878055755,ExpressionUUID->"0f6ef9aa-2eeb-4608-8ea7-63ced58b9e70"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   SubscriptBox[
    TemplateBox[{"S"},
     "RowDefault"], 
    TemplateBox[{"1"},
     "RowDefault"]], ",", 
   SubscriptBox[
    TemplateBox[{"S"},
     "RowDefault"], 
    TemplateBox[{"2"},
     "RowDefault"]]}], "}"}]], "Output",
 CellLabel->"Out[4]=",
 CellID->185463887,ExpressionUUID->"e8921775-6666-48fe-a372-a63534f3af6f"],

Cell[BoxData[
 SubscriptBox[
  TemplateBox[{"S"},
   "RowDefault"], 
  TemplateBox[{"3"},
   "RowDefault"]]], "Output",
 CellLabel->"Out[4]=",
 CellID->1092777012,ExpressionUUID->"a24a10f9-601e-4cf1-b1e6-06c7f38b07e9"],

Cell[BoxData[
 RowBox[{"Rotation", "[", 
  RowBox[{
   FractionBox["\[Pi]", "3"], ",", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"3"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "]"}]], "Output",
 CellLabel->"Out[4]=",
 CellID->1023091540,ExpressionUUID->"eb3e479f-3985-46d7-8141-11fb26efdc7b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"gc", "=", 
  RowBox[{"GrayControlledU", "[", 
   RowBox[{"cc", ",", "op"}], "]"}]}]], "Input",
 CellLabel->"In[5]:=",
 CellID->1697248997,ExpressionUUID->"53669351-8d8a-44f7-8a9a-764ee07f10b9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"ControlledU", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"1"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "4"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]}]]}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]]}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "4"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]}]]}], "-", 
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]]}]}], ")"}], " ", 
       TemplateBox[{
         TemplateBox[{"S"}, "RowDefault"], 
         TemplateBox[{"3"}, "RowDefault"], 
         TemplateBox[{"\"z\""}, "RowDefault"]},
        "Subsuperscript"]}]}], ",", 
     RowBox[{"\<\"Label\"\>", "\[Rule]", "\<\"V\"\>"}]}], "]"}], ",", 
   RowBox[{"CNOT", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"1"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"2"},
        "RowDefault"]], "}"}]}], "]"}], ",", 
   RowBox[{"ControlledU", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"2"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "4"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]}]]}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]]}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "4"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "2"}], " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]}]]}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]]}]}], ")"}], " ", 
       TemplateBox[{
         TemplateBox[{"S"}, "RowDefault"], 
         TemplateBox[{"3"}, "RowDefault"], 
         TemplateBox[{"\"z\""}, "RowDefault"]},
        "Subsuperscript"]}]}], ",", 
     RowBox[{"\<\"Label\"\>", "\[Rule]", 
      TemplateBox[{"\"V\"", "\"\[Dagger]\""},
       "Superscript"]}]}], "]"}], ",", 
   RowBox[{"CNOT", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"1"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"2"},
        "RowDefault"]], "}"}]}], "]"}], ",", 
   RowBox[{"ControlledU", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"2"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{
      RowBox[{
       FractionBox["1", "4"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]}]]}], "+", 
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]]}]}], ")"}]}], "+", 
      RowBox[{
       FractionBox["1", "4"], " ", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           RowBox[{"-", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]}]]}], "-", 
         RowBox[{"2", " ", 
          SuperscriptBox["\[ExponentialE]", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "12"]]}]}], ")"}], " ", 
       TemplateBox[{
         TemplateBox[{"S"}, "RowDefault"], 
         TemplateBox[{"3"}, "RowDefault"], 
         TemplateBox[{"\"z\""}, "RowDefault"]},
        "Subsuperscript"]}]}], ",", 
     RowBox[{"\<\"Label\"\>", "\[Rule]", "\<\"V\"\>"}]}], "]"}]}], 
  "}"}]], "Output",
 CellLabel->"Out[5]=",
 CellID->827987709,ExpressionUUID->"bd20b101-4167-47c8-ba6c-e37ec09408e1"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"qc", "=", 
  RowBox[{"QuantumCircuit", "[", "gc", "]"}]}]], "Input",
 CellLabel->"In[6]:=",
 CellID->2133712687,ExpressionUUID->"056fe344-7a45-4ece-9252-026df23a7f4c"],

Cell[BoxData[
 GraphicsBox[{
   {Dashing[{Small, Small}], LineBox[{}]}, 
   LineBox[{{{0, -1}, {6, -1}}, {{0, -2}, {6, -2}}, {{0, -3}, {6, -3}}}], {
    LineBox[{{1, -1}, {1, -3}}], DiskBox[{1, -1}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{0.6, -3.4}, {1.4, -2.6}]}, InsetBox[
     StyleBox["\<\"V\"\>",
      StripOnInput->False,
      FontSize->Scaled[0.06666666666666667],
      FontWeight->"Light",
      FontSlant->Italic], {1, -3}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{2, -1}, {2, -2}}], 
    DiskBox[{2, -1}, 0.09], {CircleBox[{2, -2}, 0.26666666666666666], 
     LineBox[{{{1.7333333333333334`, -2}, {2.2666666666666666`, -2}}, {{
        2, -2.2666666666666666`}, {2, -1.7333333333333334`}}}]}}, {
    LineBox[{{3, -2}, {3, -3}}], DiskBox[{3, -2}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{2.6, -3.4}, {3.4, -2.6}]}, InsetBox[
     StyleBox[
      TemplateBox[{"\"V\"", "\"\[Dagger]\""},
       "Superscript"],
      StripOnInput->False,
      FontSize->Scaled[0.06666666666666667],
      FontWeight->"Light",
      FontSlant->Italic], {3, -3}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{4, -1}, {4, -2}}], 
    DiskBox[{4, -1}, 0.09], {CircleBox[{4, -2}, 0.26666666666666666], 
     LineBox[{{{3.7333333333333334`, -2}, {4.266666666666667, -2}}, {{
        4, -2.2666666666666666`}, {4, -1.7333333333333334`}}}]}}, {
    LineBox[{{5, -2}, {5, -3}}], DiskBox[{5, -2}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{4.6, -3.4}, {5.4, -2.6}]}, InsetBox[
     StyleBox["\<\"V\"\>",
      StripOnInput->False,
      FontSize->Scaled[0.06666666666666667],
      FontWeight->"Light",
      FontSlant->Italic], {5, -3}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}},
  AxesStyle->Large,
  FrameStyle->Large,
  ImagePadding->{{23.400000000000002`, 23.400000000000002`}, {5, 5}},
  ImageSize->262.8,
  PlotRangePadding->Scaled[0.025]]], "Output",
 CellLabel->"Out[6]=",
 CellID->719752942,ExpressionUUID->"a951c4dc-01af-48ce-88e8-f9c52e9816f4"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"expr", "=", 
  RowBox[{"ExpressionFor", "[", "qc", "]"}]}]], "Input",
 CellLabel->"In[7]:=",
 CellID->818174054,ExpressionUUID->"d8ae5a85-3806-4e3d-87f1-c875f09de328"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{"6", "+", 
     SqrtBox["3"]}], ")"}]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "2"}], "+", 
     SqrtBox["3"]}], ")"}], " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "-", 
  RowBox[{
   FractionBox["1", "8"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"1"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"2"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "-", 
  FractionBox[
   RowBox[{"\[ImaginaryI]", " ", 
    TemplateBox[{
      TemplateBox[{"S"}, "RowDefault"], 
      TemplateBox[{"3"}, "RowDefault"], 
      TemplateBox[{"\"z\""}, "RowDefault"]},
     "Subsuperscript"]}], "8"]}]], "Output",
 CellLabel->"Out[7]=",
 CellID->1135205518,ExpressionUUID->"e4abb2f1-16ff-40d2-9409-b627aaa0741b"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"orig", "=", 
  RowBox[{"Elaborate", "@", 
   RowBox[{"ControlledU", "[", 
    RowBox[{"cc", ",", "op"}], "]"}]}]}]], "Input",
 CellLabel->"In[8]:=",
 CellID->656750883,ExpressionUUID->"034376ee-0132-4511-b27a-7637a0b0cf6a"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{"6", "+", 
     SqrtBox["3"]}], ")"}]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "2"}], "+", 
     SqrtBox["3"]}], ")"}], " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "-", 
  RowBox[{
   FractionBox["1", "8"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"1"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "+", 
  RowBox[{
   FractionBox["1", "8"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"2"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "-", 
  FractionBox[
   RowBox[{"\[ImaginaryI]", " ", 
    TemplateBox[{
      TemplateBox[{"S"}, "RowDefault"], 
      TemplateBox[{"3"}, "RowDefault"], 
      TemplateBox[{"\"z\""}, "RowDefault"]},
     "Subsuperscript"]}], "8"]}]], "Output",
 CellLabel->"Out[8]=",
 CellID->1545996111,ExpressionUUID->"d0a67e19-8a8a-4b38-9ca4-794f8ef823af"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "-", "orig"}], "//", "Simplify"}]], "Input",
 CellLabel->"In[9]:=",
 CellID->1933200289,ExpressionUUID->"20fc8386-c32d-487a-a129-36975b77fb83"],

Cell[BoxData["0"], "Output",
 CellLabel->"Out[9]=",
 CellID->230698411,ExpressionUUID->"b8a9e545-f277-4abc-a393-d1af01b1ec7c"]
}, Open  ]]
}, Dynamic[CurrentValue[
 EvaluationNotebook[], {TaggingRules, "Openers", "ExampleSection", "0"}, 
  Closed]]]],

Cell[CellGroupData[{

Cell[TextData[{
 Cell[BoxData[
  DynamicBox[ToBoxes[
    If[
     MatchQ[
      CurrentValue[
       EvaluationNotebook[], {TaggingRules, "Openers", "ExampleSection", "1"},
        Closed], 
      Alternatives[Open, True]], 
     Style[
      Graphics[{
        Thickness[0.18], 
        RGBColor[0.8509803921568627, 0.396078431372549, 0], 
        Line[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]}, AspectRatio -> 1, 
       PlotRange -> {{-3, 4}, {-1, 1}}, ImageSize -> 20], Magnification -> 
      0.68 Inherited], 
     Rotate[
      Style[
       Graphics[{
         Thickness[0.18], 
         RGBColor[0.8509803921568627, 0.396078431372549, 0], 
         Line[{{-1.8, 0.5}, {0, 0}, {1.8, 0.5}}]}, AspectRatio -> 1, 
        PlotRange -> {{-3, 4}, {-1, 1}}, ImageSize -> 20], Magnification -> 
       0.68 Inherited], Rational[1, 2] Pi, {-1.65, -1}]]],
   ImageSizeCache->{14., {0.45000000000000107`, 13.549999999999999`}}]],
  ExpressionUUID->"06a9368d-fa39-4895-a5e6-a056d15e24d1"],
 Cell[BoxData[
  TemplateBox[{1},
   "Spacer1"]],ExpressionUUID->"a889f1f7-f219-45a0-953d-bdf3dc3fcdf4"],
 "Scope",
 "\[NonBreakingSpace]\[NonBreakingSpace]",
 Cell["(1)", "ExampleCount",ExpressionUUID->
  "680a7768-bb05-4021-896d-75e750e8dca0"]
}], "ExampleSection", "ExampleSection",
 WholeCellGroupOpener->True,
 CacheGraphics->False,
 CellID->1293636265,ExpressionUUID->"ebf70c37-b619-4f46-bb3e-6f5b2dc4f03d"],

Cell[BoxData[
 RowBox[{"<<", "Q3`"}]], "Input",
 CellLabel->"In[1]:=",
 CellID->372668294,ExpressionUUID->"6741dd0e-1c08-4fca-ae13-37c01c5a4b8e"],

Cell[BoxData[
 RowBox[{"Let", "[", 
  RowBox[{"Qubit", ",", "S"}], "]"}]], "Input",
 CellLabel->"In[2]:=",
 CellID->1475238184,ExpressionUUID->"557b92b5-1c5f-44c4-bc4c-4b3db703feaa"],

Cell[TextData[{
 "Here we examine a slightly larger system: The simulation of a quantum \
circuit model takes long, specially, for large systems and for deep quantum \
circuit models. In the particular case of simulating a multi-qubit-controlled \
unitary operator, it is even worse because of the exact representation of \
numbers (raised to rational powers of the form ",
 StyleBox["Power[x,1/n]", "Input"],
 ")."
}], "ExampleText",
 CellID->556850662,ExpressionUUID->"dfd0701c-9b8d-4394-8d60-22700d0cc685"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"$L", "=", "3"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"jj", "=", 
   RowBox[{"Range", "[", "$L", "]"}]}], ";"}]}], "Input",
 CellLabel->"In[3]:=",
 CellID->1629453873,ExpressionUUID->"930d58b2-3aaf-45c3-8c7f-e04acab8abe7"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"cc", "=", 
  RowBox[{"S", "[", 
   RowBox[{"jj", ",", "None"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"T", "=", 
  RowBox[{"S", "[", 
   RowBox[{
    RowBox[{"$L", "+", "1"}], ",", "None"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"op", "=", 
  RowBox[{"Rotation", "[", 
   RowBox[{
    RowBox[{"Pi", "/", "3"}], ",", 
    RowBox[{"T", "[", "3", "]"}]}], "]"}]}]}], "Input",
 CellLabel->"In[4]:=",
 CellID->1519776967,ExpressionUUID->"2a33395c-18ed-4d6a-a93b-947270b8bc2a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   SubscriptBox[
    TemplateBox[{"S"},
     "RowDefault"], 
    TemplateBox[{"1"},
     "RowDefault"]], ",", 
   SubscriptBox[
    TemplateBox[{"S"},
     "RowDefault"], 
    TemplateBox[{"2"},
     "RowDefault"]], ",", 
   SubscriptBox[
    TemplateBox[{"S"},
     "RowDefault"], 
    TemplateBox[{"3"},
     "RowDefault"]]}], "}"}]], "Output",
 CellLabel->"Out[4]=",
 CellID->2069318952,ExpressionUUID->"efb2485b-ed73-4c41-9f24-a01e18f466d8"],

Cell[BoxData[
 SubscriptBox[
  TemplateBox[{"S"},
   "RowDefault"], 
  TemplateBox[{"4"},
   "RowDefault"]]], "Output",
 CellLabel->"Out[4]=",
 CellID->545963099,ExpressionUUID->"3b05da38-df9f-41fe-b31a-59643cdb9821"],

Cell[BoxData[
 RowBox[{"Rotation", "[", 
  RowBox[{
   FractionBox["\[Pi]", "3"], ",", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"4"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "]"}]], "Output",
 CellLabel->"Out[4]=",
 CellID->1951664909,ExpressionUUID->"16df4a19-e778-4e5c-bbb8-762b9907aaac"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"gc", "=", 
   RowBox[{"GrayControlledU", "[", 
    RowBox[{"cc", ",", "op"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"gc", "[", 
  RowBox[{"[", 
   RowBox[{";;", "3"}], "]"}], "]"}]}], "Input",
 CellLabel->"In[5]:=",
 CellID->877826104,ExpressionUUID->"770bdac4-8db5-4d29-8fc3-04b463592fb7"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   RowBox[{"ControlledU", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"1"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"1", "/", "4"}]], " ", 
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{"-", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]}]]}], "+", 
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"1", "/", "4"}]], " ", 
         SuperscriptBox["\[ExponentialE]", 
          FractionBox[
           RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]]}]}], 
       RowBox[{"2", " ", 
        SuperscriptBox["2", 
         RowBox[{"1", "/", "4"}]]}]], "+", 
      FractionBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"1", "/", "4"}]], " ", 
           SuperscriptBox["\[ExponentialE]", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]}]]}], "-", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"1", "/", "4"}]], " ", 
           SuperscriptBox["\[ExponentialE]", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]]}]}], ")"}], " ", 
        
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"]}], 
       RowBox[{"2", " ", 
        SuperscriptBox["2", 
         RowBox[{"1", "/", "4"}]]}]]}], ",", 
     RowBox[{"\<\"Label\"\>", "\[Rule]", "\<\"V\"\>"}]}], "]"}], ",", 
   RowBox[{"CNOT", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"1"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"2"},
        "RowDefault"]], "}"}]}], "]"}], ",", 
   RowBox[{"ControlledU", "[", 
    RowBox[{
     RowBox[{"{", 
      SubscriptBox[
       TemplateBox[{"S"},
        "RowDefault"], 
       TemplateBox[{"2"},
        "RowDefault"]], "}"}], ",", 
     RowBox[{
      FractionBox[
       RowBox[{
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"1", "/", "4"}]], " ", 
         SuperscriptBox["\[ExponentialE]", 
          RowBox[{"-", 
           FractionBox[
            RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]}]]}], "+", 
        RowBox[{
         SuperscriptBox["2", 
          RowBox[{"1", "/", "4"}]], " ", 
         SuperscriptBox["\[ExponentialE]", 
          FractionBox[
           RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]]}]}], 
       RowBox[{"2", " ", 
        SuperscriptBox["2", 
         RowBox[{"1", "/", "4"}]]}]], "+", 
      FractionBox[
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            SuperscriptBox["2", 
             RowBox[{"1", "/", "4"}]]}], " ", 
           SuperscriptBox["\[ExponentialE]", 
            RowBox[{"-", 
             FractionBox[
              RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]}]]}], "+", 
          RowBox[{
           SuperscriptBox["2", 
            RowBox[{"1", "/", "4"}]], " ", 
           SuperscriptBox["\[ExponentialE]", 
            FractionBox[
             RowBox[{"\[ImaginaryI]", " ", "\[Pi]"}], "24"]]}]}], ")"}], " ", 
        
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"]}], 
       RowBox[{"2", " ", 
        SuperscriptBox["2", 
         RowBox[{"1", "/", "4"}]]}]]}], ",", 
     RowBox[{"\<\"Label\"\>", "\[Rule]", 
      TemplateBox[{"\"V\"", "\"\[Dagger]\""},
       "Superscript"]}]}], "]"}]}], "}"}]], "Output",
 CellLabel->"Out[5]=",
 CellID->1980415083,ExpressionUUID->"5d28b49c-00a0-4670-96d4-8ade42905312"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"qc", "=", 
  RowBox[{"QuantumCircuit", "[", "gc", "]"}]}]], "Input",
 CellLabel->"In[6]:=",
 CellID->202922208,ExpressionUUID->"4f865cf6-90fb-411c-bdcd-55671b5e16ea"],

Cell[BoxData[
 GraphicsBox[{
   {Dashing[{Small, Small}], LineBox[{}]}, 
   LineBox[{{{0, -1}, {14, -1}}, {{0, -2}, {14, -2}}, {{0, -3}, {14, -3}}, {{
    0, -4}, {14, -4}}}], {LineBox[{{1, -1}, {1, -4}}], DiskBox[{1, -1}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{0.6, -4.4}, {1.4, -3.6}]}, InsetBox[
     StyleBox["\<\"V\"\>",
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {1, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{2, -1}, {2, -2}}], 
    DiskBox[{2, -1}, 0.09], {CircleBox[{2, -2}, 0.26666666666666666], 
     LineBox[{{{1.7333333333333334`, -2}, {2.2666666666666666`, -2}}, {{
        2, -2.2666666666666666`}, {2, -1.7333333333333334`}}}]}}, {
    LineBox[{{3, -2}, {3, -4}}], DiskBox[{3, -2}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{2.6, -4.4}, {3.4, -3.6}]}, InsetBox[
     StyleBox[
      TemplateBox[{"\"V\"", "\"\[Dagger]\""},
       "Superscript"],
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {3, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{4, -1}, {4, -2}}], 
    DiskBox[{4, -1}, 0.09], {CircleBox[{4, -2}, 0.26666666666666666], 
     LineBox[{{{3.7333333333333334`, -2}, {4.266666666666667, -2}}, {{
        4, -2.2666666666666666`}, {4, -1.7333333333333334`}}}]}}, {
    LineBox[{{5, -2}, {5, -4}}], DiskBox[{5, -2}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{4.6, -4.4}, {5.4, -3.6}]}, InsetBox[
     StyleBox["\<\"V\"\>",
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {5, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{6, -2}, {6, -3}}], 
    DiskBox[{6, -2}, 0.09], {CircleBox[{6, -3}, 0.26666666666666666], 
     LineBox[{{{5.733333333333333, -3}, {6.266666666666667, -3}}, {{
        6, -3.2666666666666666`}, {6, -2.7333333333333334`}}}]}}, {
    LineBox[{{7, -3}, {7, -4}}], DiskBox[{7, -3}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{6.6, -4.4}, {7.4, -3.6}]}, InsetBox[
     StyleBox[
      TemplateBox[{"\"V\"", "\"\[Dagger]\""},
       "Superscript"],
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {7, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{8, -1}, {8, -3}}], 
    DiskBox[{8, -1}, 0.09], {CircleBox[{8, -3}, 0.26666666666666666], 
     LineBox[{{{7.733333333333333, -3}, {8.266666666666667, -3}}, {{
        8, -3.2666666666666666`}, {8, -2.7333333333333334`}}}]}}, {
    LineBox[{{9, -3}, {9, -4}}], DiskBox[{9, -3}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{8.6, -4.4}, {9.4, -3.6}]}, InsetBox[
     StyleBox["\<\"V\"\>",
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {9, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{10, -2}, {10, -3}}], 
    DiskBox[{10, -2}, 0.09], {CircleBox[{10, -3}, 0.26666666666666666], 
     LineBox[{{{9.733333333333333, -3}, {10.266666666666667`, -3}}, {{
        10, -3.2666666666666666`}, {10, -2.7333333333333334`}}}]}}, {
    LineBox[{{11, -3}, {11, -4}}], DiskBox[{11, -3}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{10.6, -4.4}, {11.4, -3.6}]}, InsetBox[
     StyleBox[
      TemplateBox[{"\"V\"", "\"\[Dagger]\""},
       "Superscript"],
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {11, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}, {
    LineBox[{{12, -1}, {12, -3}}], 
    DiskBox[{12, -1}, 0.09], {CircleBox[{12, -3}, 0.26666666666666666], 
     LineBox[{{{11.733333333333333`, -3}, {12.266666666666667`, -3}}, {{
        12, -3.2666666666666666`}, {12, -2.7333333333333334`}}}]}}, {
    LineBox[{{13, -3}, {13, -4}}], DiskBox[{13, -3}, 0.09], 
    {GrayLevel[1], EdgeForm[GrayLevel[0]], 
     RectangleBox[{12.6, -4.4}, {13.4, -3.6}]}, InsetBox[
     StyleBox["\<\"V\"\>",
      StripOnInput->False,
      FontSize->Scaled[0.02857142857142857],
      FontWeight->"Light",
      FontSlant->Italic], {13, -4}, 
     ImageScaled[{Rational[1, 2], Rational[1, 2]}]]}},
  AxesStyle->Large,
  FrameStyle->Large,
  ImagePadding->{{23.400000000000002`, 23.400000000000002`}, {5, 5}},
  ImageSize->550.8000000000001,
  PlotRangePadding->Scaled[0.025]]], "Output",
 CellLabel->"Out[6]=",
 CellID->1501739206,ExpressionUUID->"51a8d768-bec7-48fb-b246-f6ef3ef9809c"]
}, Open  ]],

Cell["\<\
Let us now evaluate the quantum circuit model. Before doing it, note that it \
may take long as mentioned at the beginning of the current example.\
\>", "ExampleText",
 CellID->775491398,ExpressionUUID->"eabbefdc-e1f6-4c52-9970-5bab3a426570"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{"expr", "=", 
   RowBox[{"ExpressionFor", "[", "qc", "]"}]}], "]"}]], "Input",
 CellLabel->"In[7]:=",
 CellID->870691906,ExpressionUUID->"ec9f6adc-3b25-43ff-aa83-175119cd29a9"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.464558`", ",", 
   RowBox[{
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{"14", "+", 
       SqrtBox["3"]}], ")"}]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "2"}], "+", 
       SqrtBox["3"]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "2"}], "+", 
       SqrtBox["3"]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", "2"}], "+", 
       SqrtBox["3"]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{"2", "-", 
       SqrtBox["3"]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{"2", "-", 
       SqrtBox["3"]}], ")"}], " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"1"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{"2", "-", 
       SqrtBox["3"]}], ")"}], " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"2"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}], "+", 
    RowBox[{
     FractionBox["1", "16"], " ", 
     RowBox[{"(", 
      RowBox[{"2", "-", 
       SqrtBox["3"]}], ")"}], " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"3"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}], "-", 
    FractionBox[
     RowBox[{"\[ImaginaryI]", " ", 
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"]}], "16"]}]}], "}"}]], "Output",
 CellLabel->"Out[7]=",
 CellID->181030719,ExpressionUUID->"a185033e-1c9d-415c-adeb-172a952888d0"]
}, Open  ]],

Cell[TextData[{
 "When the direct evaluation takes too long, one way to get around is use ",
 Cell[BoxData[
  TemplateBox[{
    Cell[
     TextData["Matrix"]], "paclet:Q3/ref/Matrix", "Q3 Package Symbol"},
   "PackageLink",
   BaseStyle->"InlineFormula"]], "InlineFormula",
  FontFamily->"Source Sans Pro",ExpressionUUID->
  "7141e680-cb54-4c39-b6a6-33b150343f73"],
 " which is usually faster than ",
 Cell[BoxData[
  TemplateBox[{
    Cell[
     TextData["ExpressionFor"]], "paclet:Q3/ref/ExpressionFor", 
    "Q3 Package Symbol"},
   "PackageLink",
   BaseStyle->"InlineFormula"]], "InlineFormula",
  FontFamily->"Source Sans Pro",ExpressionUUID->
  "dff14bc4-0754-4a27-aa2f-b572a3af92c1"],
 " or ",
 Cell[BoxData[
  TemplateBox[{
    Cell[
     TextData["Elaborate"]], "paclet:Q3/ref/Elaborate", "Q3 Package Symbol"},
   "PackageLink",
   BaseStyle->"InlineFormula"]], "InlineFormula",
  FontFamily->"Source Sans Pro",ExpressionUUID->
  "cb7b5ad3-d5d9-4d1c-b8e3-9021eba19d0a"],
 " for deep quantum circuit models."
}], "ExampleText",
 CellID->120927342,ExpressionUUID->"826f26bb-7dcf-46da-b227-59bb2f507b36"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{
   RowBox[{"expr1", "=", 
    RowBox[{"ExpressionFor", "[", 
     RowBox[{
      RowBox[{"Matrix", "[", "qc", "]"}], ",", 
      RowBox[{"Qubits", "@", "qc"}]}], "]"}]}], ";"}], "]"}]], "Input",
 CellLabel->"In[8]:=",
 CellID->2122277688,ExpressionUUID->"2e5fcc72-d275-4986-bcd6-f676fd2b5265"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.833118`", ",", "Null"}], "}"}]], "Output",
 CellLabel->"Out[8]=",
 CellID->636938091,ExpressionUUID->"b1c1daa8-afe7-45fa-a8ec-4341f72de83a"]
}, Open  ]],

Cell["\<\
Another way is to approximate the exact numbers by floating-point numbers. \
(This method does not always work. It helps here because the slowing down in \
this case is due to the exact representation of numbers.)\
\>", "ExampleText",
 CellID->156878309,ExpressionUUID->"bbfe6b6a-57b3-4951-9e79-a9214ad9c363"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Timing", "[", 
  RowBox[{"expr2", "=", 
   RowBox[{"Chop", "@", 
    RowBox[{"ExpressionFor", "[", 
     RowBox[{"N", "@", "qc"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->"In[9]:=",
 CellID->688370298,ExpressionUUID->"5900f1e2-9d46-4ebf-84dd-db0e0deb3f15"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"1.121587`", ",", 
   RowBox[{"0.9832531754730535`", "\[VeryThinSpace]", "-", 
    RowBox[{"0.0167468245269451`", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{"0.01674682452694508`", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999991`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{"0.016746824526945082`", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999993`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999991`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{"0.01674682452694522`", " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999992`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999991`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999992`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999992`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TagBox[
      RowBox[{
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"1"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"2"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"3"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm], 
       TagBox[
        TemplateBox[{
          TemplateBox[{"S"}, "RowDefault"], 
          TemplateBox[{"4"}, "RowDefault"], 
          TemplateBox[{"\"z\""}, "RowDefault"]},
         "Subsuperscript"],
        DisplayForm]}],
      DisplayForm]}], "+", 
    RowBox[{"0.016746824526945307`", " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"1"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}], "+", 
    RowBox[{"0.016746824526945158`", " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"2"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}], "+", 
    RowBox[{"0.016746824526945224`", " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"3"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}], "-", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"0.`", "\[VeryThinSpace]", "+", 
       RowBox[{"0.06249999999999992`", " ", "\[ImaginaryI]"}]}], ")"}], " ", 
     TemplateBox[{
       TemplateBox[{"S"}, "RowDefault"], 
       TemplateBox[{"4"}, "RowDefault"], 
       TemplateBox[{"\"z\""}, "RowDefault"]},
      "Subsuperscript"]}]}]}], "}"}]], "Output",
 CellLabel->"Out[9]=",
 CellID->2054568508,ExpressionUUID->"446da830-3bf0-41c4-be4a-a0eb7a7e0a0c"]
}, Open  ]],

Cell["\<\
Anyhow, the result should agree with the exact analytical expression.\
\>", "ExampleText",
 CellID->633096609,ExpressionUUID->"38af7e4a-9512-4953-bd71-7fce55de6321"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"orig", "=", 
  RowBox[{"Elaborate", "@", 
   RowBox[{"ControlledU", "[", 
    RowBox[{"cc", ",", "op"}], "]"}]}]}]], "Input",
 CellLabel->"In[10]:=",
 CellID->1008023705,ExpressionUUID->"60610d31-568c-4ba0-8c7d-467f7c057358"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{"14", "+", 
     SqrtBox["3"]}], ")"}]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "2"}], "+", 
     SqrtBox["3"]}], ")"}], " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "2"}], "+", 
     SqrtBox["3"]}], ")"}], " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"-", "2"}], "+", 
     SqrtBox["3"]}], ")"}], " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "-", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "-", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "-", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", "\[ImaginaryI]", " ", 
   TagBox[
    RowBox[{
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"1"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"2"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"3"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm], 
     TagBox[
      TemplateBox[{
        TemplateBox[{"S"}, "RowDefault"], 
        TemplateBox[{"4"}, "RowDefault"], 
        TemplateBox[{"\"z\""}, "RowDefault"]},
       "Subsuperscript"],
      DisplayForm]}],
    DisplayForm]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"1"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"2"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "+", 
  RowBox[{
   FractionBox["1", "16"], " ", 
   RowBox[{"(", 
    RowBox[{"2", "-", 
     SqrtBox["3"]}], ")"}], " ", 
   TemplateBox[{
     TemplateBox[{"S"}, "RowDefault"], 
     TemplateBox[{"3"}, "RowDefault"], 
     TemplateBox[{"\"z\""}, "RowDefault"]},
    "Subsuperscript"]}], "-", 
  FractionBox[
   RowBox[{"\[ImaginaryI]", " ", 
    TemplateBox[{
      TemplateBox[{"S"}, "RowDefault"], 
      TemplateBox[{"4"}, "RowDefault"], 
      TemplateBox[{"\"z\""}, "RowDefault"]},
     "Subsuperscript"]}], "16"]}]], "Output",
 CellLabel->"Out[10]=",
 CellID->2029864610,ExpressionUUID->"c167f544-5b21-4b51-88b8-cc805a8ab655"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"expr", "-", "orig"}], "//", "Simplify"}]], "Input",
 CellLabel->"In[11]:=",
 CellID->1184507969,ExpressionUUID->"1961025c-36bf-46c3-89aa-76fbc654e0c2"],

Cell[BoxData["0"], "Output",
 CellLabel->"Out[11]=",
 CellID->1949778779,ExpressionUUID->"80e47830-ce08-4cd0-bf32-8948c13dc332"]
}, Open  ]]
}, Dynamic[CurrentValue[
 EvaluationNotebook[], {TaggingRules, "Openers", "ExampleSection", "1"}, 
  Closed]]]]
}, Dynamic[CurrentValue[
 EvaluationNotebook[], {TaggingRules, "Openers", "PrimaryExamplesSection"}, 
  Closed]]]],

Cell[BoxData[GridBox[{
   {
    DynamicBox[FEPrivate`ImportImage[
      FrontEnd`FileName[{"Documentation", "FooterIcons"}, 
       "RelatedFunction.png"]],
     ImageSizeCache->{50., {27., 33.}}], GridBox[{
      {
       StyleBox[
        RowBox[{"See", " ", "Also"}], "SeeAlsoSection"]},
      {Cell[TextData[Cell[BoxData[
        TemplateBox[{
          Cell[
           TextData["GrayControlledW"]], "paclet:Q3/ref/GrayControlledW", 
          "Q3 Package Symbol"},
         "PackageLink",
         BaseStyle->"InlineFormula"]], "InlineFormula",
        FontFamily->"Source Sans Pro",ExpressionUUID->
        "178cb4ea-8e4c-402f-aa1b-02e43324eca8"]], "SeeAlso",ExpressionUUID->
        "3a45f0a7-4623-4251-ad84-e6df9f2d86b3"]}
     }]}
  }]], "SeeAlsoSection",ExpressionUUID->"6424f79c-01f1-4a42-a67e-\
703309819736"],

Cell[BoxData[GridBox[{
   {
    DynamicBox[FEPrivate`ImportImage[
      FrontEnd`FileName[{"Documentation", "FooterIcons"}, 
       "RelatedTutorial.png"]],
     ImageSizeCache->{50., {27., 33.}}], GridBox[{
      {
       StyleBox["Tutorials", "TutorialsSection"]},
      {
       RowBox[{"\[FilledVerySmallSquare]", Cell[BoxData[
         TemplateBox[{
           Cell[
            TextData["Quisso: Quick Start"]], 
           "paclet:Q3/tutorial/QuissoQuickStart"},
          "RefLinkPlain",
          BaseStyle->{"Tutorials"}]], "Tutorials",ExpressionUUID->
         "6404d241-ca9f-436f-9ab8-99822c37376a"]}]},
      {
       RowBox[{"\[FilledVerySmallSquare]", Cell[BoxData[
         TemplateBox[{
           Cell[
            TextData["Q3: Quick Start"]], "paclet:Q3/tutorial/Q3QuickStart"},
          "RefLinkPlain",
          BaseStyle->{"Tutorials"}]], "Tutorials",ExpressionUUID->
         "b74e25bd-8715-47e9-b7df-f47abb0e98f4"]}]}
     }]}
  }]], "TutorialsSection",ExpressionUUID->"e51cac65-12d4-4719-bd65-\
ca14658bb865"],

Cell[BoxData[GridBox[{
   {
    DynamicBox[FEPrivate`ImportImage[
      FrontEnd`FileName[{"Documentation", "FooterIcons"}, "RelatedGuide.png"]],
     ImageSizeCache->{50., {27., 33.}}], GridBox[{
      {
       StyleBox[
        RowBox[{"Related", " ", "Guides"}], "MoreAboutSection"]},
      {
       RowBox[{"\[FilledVerySmallSquare]", Cell[BoxData[
         TemplateBox[{
           Cell[
            TextData["Quisso Package Guide"]], 
           "paclet:Q3/guide/QuissoPackageGuide"},
          "RefLinkPlain",
          BaseStyle->{"MoreAbout"}]], "MoreAbout",ExpressionUUID->
         "5880d1e4-703e-4437-bbd8-36dd491229a4"]}]},
      {
       RowBox[{"\[FilledVerySmallSquare]", Cell[BoxData[
         TemplateBox[{
           Cell[
            TextData["Q3"]], "paclet:Q3/guide/Q3"},
          "RefLinkPlain",
          BaseStyle->{"MoreAbout"}]], "MoreAbout",ExpressionUUID->
         "e73d2779-abae-4d63-95de-70a9a7526b7b"]}]}
     }]}
  }]], "MoreAboutSection",ExpressionUUID->"e92a3e2c-fd16-4005-8c2d-\
21bd5a995a79"],

Cell[CellGroupData[{

Cell["Related Demonstrations", "RelatedDemonstrationsSection",
 CellID->1268215905,ExpressionUUID->"334d5f8a-c623-429e-bda5-ac18bcfba05b"],

Cell[TextData[ButtonBox["QuantumCircuit Usage Examples",
 BaseStyle->"Link",
 ButtonData->
  "paclet:Q3/tutorial/QuantumCircuitUsage"]], "RelatedDemonstrations",
 CellID->1752034351,ExpressionUUID->"cb17dff2-5489-4c25-8007-4571dfbdb9d5"]
}, Open  ]],

Cell[" ", "FooterCell",ExpressionUUID->"ed8d3d88-686f-4237-a4bb-54bfdd921aae"]
},
Saveable->False,
ScreenStyleEnvironment->"Working",
WindowSize->{900, 830},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
WindowTitle->"GrayControlledU",
TaggingRules->{
 "ModificationHighlight" -> False, "ColorType" -> "", "LinkTrails" -> "", 
  "ExampleCounter" -> 1, 
  "Openers" -> {
   "PrimaryExamplesSection" -> Open, 
    "ExampleSection" -> {"0" -> Open, "1" -> Closed}}, "NewStyles" -> True, 
  "CitationPopupData" -> $Failed, "ShowCitation" -> False, "RootCaptions" -> 
  "", "Metadata" -> {
   "built" -> "{2021, 12, 24, 13, 7, 9.867650}", 
    "history" -> {"12", "", "", ""}, "context" -> "Q3`", "keywords" -> {}, 
    "specialkeywords" -> {}, "tutorialcollectionlinks" -> {}, "index" -> True,
     "label" -> "Q3 Symbol", "language" -> "en", "paclet" -> "Q3", "status" -> 
    "None", "summary" -> 
    "GrayControlledU[{q1, q2, ...}, u] uses the Gray code to decompose the \
n-bit controlled unitary gate into elementary gates. Here q1, q2, ... are the \
control qubits and u is the unitary operator on the target qubit.", 
    "synonyms" -> {}, "tabletags" -> {}, "title" -> "GrayControlledU", 
    "titlemodifier" -> "", "windowtitle" -> "GrayControlledU", "type" -> 
    "Symbol", "uri" -> "Q3/ref/GrayControlledU", "WorkflowDockedCell" -> ""}, 
  "SearchTextTranslated" -> ""},
CellContext->"Global`",
FrontEndVersion->"13.0 for Mac OS X ARM (64-bit) (December 2, 2021)",
StyleDefinitions->Notebook[{
   Cell[
    StyleData[
    StyleDefinitions -> FrontEnd`FileName[{"Wolfram"}, "Reference.nb"]]], 
   Cell[
    StyleData["Input"], CellContext -> "Global`"], 
   Cell[
    StyleData["Output"], CellContext -> "Global`"]}, Visible -> False, 
  FrontEndVersion -> "13.0 for Mac OS X ARM (64-bit) (December 2, 2021)", 
  StyleDefinitions -> "Default.nb"],
ExpressionUUID->"45450b31-a036-42de-9a25-6629c1611d9c"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{
 "PrimaryExamplesSection"->{
  Cell[9665, 255, 1390, 37, 36, "PrimaryExamplesSection",ExpressionUUID->"cb14edfe-4e41-4b7f-bb40-ce1d2a636275",
   CellTags->"PrimaryExamplesSection",
   CellID->1343452301]}
 }
*)
(*CellTagsIndex
CellTagsIndex->{
 {"PrimaryExamplesSection", 81108, 2499}
 }
*)
(*NotebookFileOutline
Notebook[{
Cell[587, 21, 6708, 165, 57, "AnchorBarGrid",ExpressionUUID->"47048ba5-f0a2-4e20-af56-38a63a82a885",
 CellID->1],
Cell[7298, 188, 85, 0, 23, "ContextNameCell",ExpressionUUID->"22b3d455-ffc2-46f7-b5fe-ea32a14c2896"],
Cell[CellGroupData[{
Cell[7408, 192, 558, 14, 60, "ObjectNameGrid",ExpressionUUID->"6dd8a8fd-ae6b-498f-aab0-2e155d2a213c"],
Cell[7969, 208, 1659, 42, 134, "Usage",ExpressionUUID->"b3e4f65c-2d83-4354-8446-bf100f73dabc",
 CellID->982511436]
}, Open  ]],
Cell[CellGroupData[{
Cell[9665, 255, 1390, 37, 36, "PrimaryExamplesSection",ExpressionUUID->"cb14edfe-4e41-4b7f-bb40-ce1d2a636275",
 CellTags->"PrimaryExamplesSection",
 CellID->1343452301],
Cell[CellGroupData[{
Cell[11080, 296, 1367, 36, 31, "ExampleSection",ExpressionUUID->"34e404e1-5794-44af-ae85-eb441e923296",
 CellID->759758349],
Cell[12450, 334, 145, 3, 29, "Input",ExpressionUUID->"de7e4126-573b-4352-9228-57135f392984",
 CellID->615462090],
Cell[12598, 339, 181, 4, 29, "Input",ExpressionUUID->"3a8b49f4-1d18-43e6-af32-b3cc90ed19d0",
 CellID->490833089],
Cell[12782, 345, 271, 7, 48, "Input",ExpressionUUID->"e7251fdf-3af5-4aee-aa05-19d24d1b4c03",
 CellID->947038696],
Cell[CellGroupData[{
Cell[13078, 356, 504, 14, 66, "Input",ExpressionUUID->"0f6ef9aa-2eeb-4608-8ea7-63ced58b9e70",
 CellID->1878055755],
Cell[13585, 372, 373, 14, 37, "Output",ExpressionUUID->"e8921775-6666-48fe-a372-a63534f3af6f",
 CellID->185463887],
Cell[13961, 388, 218, 7, 37, "Output",ExpressionUUID->"a24a10f9-601e-4cf1-b1e6-06c7f38b07e9",
 CellID->1092777012],
Cell[14182, 397, 370, 10, 50, "Output",ExpressionUUID->"eb3e479f-3985-46d7-8141-11fb26efdc7b",
 CellID->1023091540]
}, Open  ]],
Cell[CellGroupData[{
Cell[14589, 412, 217, 5, 29, "Input",ExpressionUUID->"53669351-8d8a-44f7-8a9a-764ee07f10b9",
 CellID->1697248997],
Cell[14809, 419, 5127, 159, 128, "Output",ExpressionUUID->"bd20b101-4167-47c8-ba6c-e37ec09408e1",
 CellID->827987709]
}, Open  ]],
Cell[CellGroupData[{
Cell[19973, 583, 191, 4, 29, "Input",ExpressionUUID->"056fe344-7a45-4ece-9252-026df23a7f4c",
 CellID->2133712687],
Cell[20167, 589, 2098, 47, 121, "Output",ExpressionUUID->"a951c4dc-01af-48ce-88e8-f9c52e9816f4",
 CellID->719752942]
}, Open  ]],
Cell[CellGroupData[{
Cell[22302, 641, 191, 4, 70, "Input",ExpressionUUID->"d8ae5a85-3806-4e3d-87f1-c875f09de328",
 CellID->818174054],
Cell[22496, 647, 3512, 122, 55, "Output",ExpressionUUID->"e4abb2f1-16ff-40d2-9409-b627aaa0741b",
 CellID->1135205518]
}, Open  ]],
Cell[CellGroupData[{
Cell[26045, 774, 247, 6, 70, "Input",ExpressionUUID->"034376ee-0132-4511-b27a-7637a0b0cf6a",
 CellID->656750883],
Cell[26295, 782, 3512, 122, 55, "Output",ExpressionUUID->"d0a67e19-8a8a-4b38-9ca4-794f8ef823af",
 CellID->1545996111]
}, Open  ]],
Cell[CellGroupData[{
Cell[29844, 909, 185, 4, 70, "Input",ExpressionUUID->"20fc8386-c32d-487a-a129-36975b77fb83",
 CellID->1933200289],
Cell[30032, 915, 126, 2, 37, "Output",ExpressionUUID->"b8a9e545-f277-4abc-a393-d1af01b1ec7c",
 CellID->230698411]
}, Open  ]]
}, Dynamic[CurrentValue[EvaluationNotebook[], {TaggingRules, "Openers", "ExampleSection", "0"}, Closed]]]],
Cell[CellGroupData[{
Cell[30307, 925, 1394, 36, 70, "ExampleSection",ExpressionUUID->"ebf70c37-b619-4f46-bb3e-6f5b2dc4f03d",
 CellID->1293636265],
Cell[31704, 963, 145, 3, 70, "Input",ExpressionUUID->"6741dd0e-1c08-4fca-ae13-37c01c5a4b8e",
 CellID->372668294],
Cell[31852, 968, 182, 4, 70, "Input",ExpressionUUID->"557b92b5-1c5f-44c4-bc4c-4b3db703feaa",
 CellID->1475238184],
Cell[32037, 974, 509, 9, 70, "ExampleText",ExpressionUUID->"dfd0701c-9b8d-4394-8d60-22700d0cc685",
 CellID->556850662],
Cell[32549, 985, 272, 7, 70, "Input",ExpressionUUID->"930d58b2-3aaf-45c3-8c7f-e04acab8abe7",
 CellID->1629453873],
Cell[CellGroupData[{
Cell[32846, 996, 504, 14, 70, "Input",ExpressionUUID->"2a33395c-18ed-4d6a-a93b-947270b8bc2a",
 CellID->1519776967],
Cell[33353, 1012, 485, 19, 37, "Output",ExpressionUUID->"efb2485b-ed73-4c41-9f24-a01e18f466d8",
 CellID->2069318952],
Cell[33841, 1033, 217, 7, 37, "Output",ExpressionUUID->"3b05da38-df9f-41fe-b31a-59643cdb9821",
 CellID->545963099],
Cell[34061, 1042, 370, 10, 50, "Output",ExpressionUUID->"16df4a19-e778-4e5c-bbb8-762b9907aaac",
 CellID->1951664909]
}, Open  ]],
Cell[CellGroupData[{
Cell[34468, 1057, 337, 9, 70, "Input",ExpressionUUID->"770bdac4-8db5-4d29-8fc3-04b463592fb7",
 CellID->877826104],
Cell[34808, 1068, 4143, 129, 130, "Output",ExpressionUUID->"5d28b49c-00a0-4670-96d4-8ade42905312",
 CellID->1980415083]
}, Open  ]],
Cell[CellGroupData[{
Cell[38988, 1202, 190, 4, 70, "Input",ExpressionUUID->"4f865cf6-90fb-411c-bdcd-55671b5e16ea",
 CellID->202922208],
Cell[39181, 1208, 4751, 103, 157, "Output",ExpressionUUID->"51a8d768-bec7-48fb-b246-f6ef3ef9809c",
 CellID->1501739206]
}, Open  ]],
Cell[43947, 1314, 252, 4, 70, "ExampleText",ExpressionUUID->"eabbefdc-e1f6-4c52-9970-5bab3a426570",
 CellID->775491398],
Cell[CellGroupData[{
Cell[44224, 1322, 225, 5, 70, "Input",ExpressionUUID->"ec9f6adc-3b25-43ff-aa83-175119cd29a9",
 CellID->870691906],
Cell[44452, 1329, 9545, 313, 119, "Output",ExpressionUUID->"a185033e-1c9d-415c-adeb-172a952888d0",
 CellID->181030719]
}, Open  ]],
Cell[54012, 1645, 1111, 31, 70, "ExampleText",ExpressionUUID->"826f26bb-7dcf-46da-b227-59bb2f507b36",
 CellID->120927342],
Cell[CellGroupData[{
Cell[55148, 1680, 343, 9, 70, "Input",ExpressionUUID->"2e5fcc72-d275-4986-bcd6-f676fd2b5265",
 CellID->2122277688],
Cell[55494, 1691, 182, 4, 37, "Output",ExpressionUUID->"b1c1daa8-afe7-45fa-a8ec-4341f72de83a",
 CellID->636938091]
}, Open  ]],
Cell[55691, 1698, 319, 5, 70, "ExampleText",ExpressionUUID->"bbfe6b6a-57b3-4951-9e79-a9214ad9c363",
 CellID->156878309],
Cell[CellGroupData[{
Cell[56035, 1707, 280, 7, 70, "Input",ExpressionUUID->"5900f1e2-9d46-4ebf-84dd-db0e0deb3f15",
 CellID->688370298],
Cell[56318, 1716, 9496, 293, 77, "Output",ExpressionUUID->"446da830-3bf0-41c4-be4a-a0eb7a7e0a0c",
 CellID->2054568508]
}, Open  ]],
Cell[65829, 2012, 175, 3, 70, "ExampleText",ExpressionUUID->"38af7e4a-9512-4953-bd71-7fce55de6321",
 CellID->633096609],
Cell[CellGroupData[{
Cell[66029, 2019, 249, 6, 70, "Input",ExpressionUUID->"60610d31-568c-4ba0-8c7d-467f7c057358",
 CellID->1008023705],
Cell[66281, 2027, 8876, 311, 119, "Output",ExpressionUUID->"c167f544-5b21-4b51-88b8-cc805a8ab655",
 CellID->2029864610]
}, Open  ]],
Cell[CellGroupData[{
Cell[75194, 2343, 186, 4, 70, "Input",ExpressionUUID->"1961025c-36bf-46c3-89aa-76fbc654e0c2",
 CellID->1184507969],
Cell[75383, 2349, 128, 2, 37, "Output",ExpressionUUID->"80e47830-ce08-4cd0-bf32-8948c13dc332",
 CellID->1949778779]
}, Open  ]]
}, Dynamic[CurrentValue[EvaluationNotebook[], {TaggingRules, "Openers", "ExampleSection", "1"}, Closed]]]]
}, Dynamic[CurrentValue[EvaluationNotebook[], {TaggingRules, "Openers", "PrimaryExamplesSection"}, Closed]]]],
Cell[75753, 2360, 822, 21, 70, "SeeAlsoSection",ExpressionUUID->"6424f79c-01f1-4a42-a67e-703309819736"],
Cell[76578, 2383, 1036, 27, 70, "TutorialsSection",ExpressionUUID->"e51cac65-12d4-4719-bd65-ca14658bb865"],
Cell[77617, 2412, 1031, 27, 70, "MoreAboutSection",ExpressionUUID->"e92a3e2c-fd16-4005-8c2d-21bd5a995a79"],
Cell[CellGroupData[{
Cell[78673, 2443, 138, 1, 70, "RelatedDemonstrationsSection",ExpressionUUID->"334d5f8a-c623-429e-bda5-ac18bcfba05b",
 CellID->1268215905],
Cell[78814, 2446, 237, 4, 70, "RelatedDemonstrations",ExpressionUUID->"cb17dff2-5489-4c25-8007-4571dfbdb9d5",
 CellID->1752034351]
}, Open  ]],
Cell[79066, 2453, 78, 0, 70, "FooterCell",ExpressionUUID->"ed8d3d88-686f-4237-a4bb-54bfdd921aae"]
}
]
*)

(* End of internal cache information *)

